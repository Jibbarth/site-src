{% extends 'base.html.twig' %}

{% set meta_img = article.image ?? unsplash_url('coding', 600, 400) %}
{% block title %}{{ article.title }} // {{ author }}{% endblock %}
{% block og_type %}article{% endblock %}
{% block description %}{{ article.getAbstract()|markdown_to_html|striptags|raw }}{% endblock %}
{% block meta_image %}{{ meta_img }}{% endblock %}
{% block header_image %}
    {% if article.image is not null %}
        <img
            class="absolute inset-0 w-full h-full object-cover opacity-30"
            src="{{ article.image }}"
             alt="Banner image for this article">
    {% else %}
        {% set banner = unsplash_photo('coding', 1600, 300) %}
        <img
            class="absolute inset-0 w-full h-full object-cover opacity-20"
            src="{{ banner.blurhash }}"
            {{ stimulus_controller('symfony/ux-lazy-image/lazy-image', {
                src: banner.fullUrl
            }) }}
            alt="Banner image for this article">
    {% endif %}
{% endblock %}

{% block sub_profile %}
    <div class="text-center mt-1">
        <h1 class="block text-foreground text-3xl md:text-5xl font-bold mb-2 leading-tight">{{ article.title }}</h1>
        <p class="inline-block text-muted-foreground text-lg font-medium">Published {{ article.date|format_date(pattern='MMMM d, Y') }}</p>
    </div>
{% endblock %}
{% block body %}
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
             <div class="rounded-xl border border-border bg-muted/30 dark:bg-muted/40 p-6 md:p-10 shadow-sm">
                <div class="markdown prose dark:prose-invert max-w-none" {{ stimulus_controller('code-highlight') }}>
                    {% if is_outdated_article(article) %}
                        {{ include('_partials/outdated.html.twig') }}
                    {% endif %}
                    {{ article.content | markdown_to_html }}
                </div>

                <div class="mt-8 pt-6 border-t border-border flex flex-wrap gap-4 justify-end">
                    <a href="#" {{ stimulus_controller('share') }} class="share hide inline-flex items-center px-4 py-2 rounded-md bg-secondary text-secondary-foreground hover:bg-secondary/80 transition-colors text-sm font-medium" data-title="{{ article.title }}">
                        {{ ux_icon('fa-solid:share-alt', {'class': 'mr-2 w-4 h-4'}) }}
                        Share
                    </a>
                    <a href="https://github.com/{{ github_user }}/site-src/edit/master/data/_posts/{{ article.id }}.md"
                       target="_blank" rel="nofollow,noopener"
                       class="inline-flex items-center px-4 py-2 rounded-md border border-border bg-background hover:bg-accent hover:text-accent-foreground transition-colors text-sm font-medium">
                        {{ ux_icon('fa6-brands:github-alt', {'class': 'mr-2 w-4 h-4'}) }}
                        Found a typo?
                    </a>
                </div>
            </div>
             <div class="mt-8 text-center">
                {{ include('_partials/back_home.html.twig') }}
            </div>
        </div>
    </div>
{% endblock %}
